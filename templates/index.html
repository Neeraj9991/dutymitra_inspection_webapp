<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Duty Mitra Report Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: #f4f6fb;
      }
      .dm-card {
        border-radius: 16px;
        border: none;
      }
      .dm-header {
        border-bottom: 1px solid #e2e6f0;
        padding-bottom: 0.75rem;
        margin-bottom: 1.25rem;
      }
      .dm-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: #0e1949;
        margin-bottom: 0.1rem;
      }
      .dm-subtitle {
        font-size: 0.9rem;
        color: #6c757d;
      }
      .dm-logo {
        max-height: 52px;
        object-fit: contain;
      }
      .form-label {
        font-weight: 500;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <div class="row justify-content-center">
        <div class="col-lg-6">
          <div class="card shadow-sm dm-card">
            <div class="card-body">
              <!-- Header: Title left, Logo right -->
              <div class="d-flex justify-content-between align-items-center dm-header">
                <div>
                  <div class="dm-title">Duty Mitra Report Gen</div>
                  <div class="dm-subtitle">
                    Generate DOCX reports & preview night checks.
                  </div>
                </div>
                <div>
                  <img
                    src="{{ url_for('static', filename='logo.png') }}"
                    alt="Company Logo"
                    class="dm-logo"
                  />
                </div>
              </div>

              <!-- Flash messages -->
              {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                  {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                      {{ message }}
                      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                  {% endfor %}
                {% endif %}
              {% endwith %}

              <form method="post" enctype="multipart/form-data">
                <!-- Report type (for future: auto-fill sheet link) -->
                <div class="mb-3">
                  <label for="report_type" class="form-label">Report Type</label>
                  <select
                    class="form-select"
                    id="report_type"
                    name="report_type"
                  >
                    <option value="night_check" selected>Night Check</option>
                    <option value="custom">Custom / Other</option>
                  </select>

                </div>

                <div class="mb-3">
                  <input
                  
                    type="hidden"
                    class="form-control"
                    id="sheet_input"
                    name="sheet_input"
                    placeholder="Paste Google Sheet link or ID"
                    required
                  />
                 
                </div>

                <!-- Removed Worksheet gid as requested -->

                <div class="mb-3">
                  <label for="date" class="form-label">Report Date</label>
                  <input
                    type="date"
                    class="form-control"
                    id="date"
                    name="date"
                    required
                  />
                </div>

                <div class="mb-3">
                  <label for="template_file" class="form-label">Upload DOCX Template (optional)</label>
                  <input
                    class="form-control"
                    type="file"
                    id="template_file"
                    name="template_file"
                    accept=".docx"
                  />
                  <div class="form-text">
                    If you don't upload, the default <code>template.docx</code> will be used.
                  </div>
                </div>

                <div class="d-grid gap-2 mt-4">
                  <button
                    type="submit"
                    name="action"
                    value="download_zip"
                    class="btn btn-outline-secondary"
                  >
                    Generate DOCX ZIP
                  </button>
                  <button
                    type="submit"
                    name="action"
                    value="preview"
                    class="btn btn-primary"
                  >
                    Preview & Print
                  </button>
                </div>
              </form>
            </div>
          </div>
          <p class="text-center text-muted small mt-3">
            You can change the report format anytime by uploading a new DOCX template.
          </p>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
   <script>
  // Values injected from Flask environment (.env)
  const NIGHT_CHECK_SHEET_URL = "{{ night_check_url | default('') }}";

  const reportTypeSelect = document.getElementById("report_type");
  const sheetInput = document.getElementById("sheet_input");

  // On dropdown change → auto-fill hidden field
  reportTypeSelect.addEventListener("change", function () {
    const selected = this.value;

    if (selected === "night_check") {
      if (NIGHT_CHECK_SHEET_URL) {
        sheetInput.value = NIGHT_CHECK_SHEET_URL;
      } else {
        sheetInput.value = "";
        console.warn("NIGHT_CHECK_SHEET_URL is not defined in .env");
      }
    } else {
      // Custom type → leave blank or allow future logic
      sheetInput.value = "";
    }
  });

  // Auto-set default selection on page load
  window.addEventListener("DOMContentLoaded", () => {
    if (reportTypeSelect.value === "night_check" && NIGHT_CHECK_SHEET_URL) {
      sheetInput.value = NIGHT_CHECK_SHEET_URL;
    }
  });
</script>



  </body>
</html>
